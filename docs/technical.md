# AgentScanner 技术文档

## 1. 项目概述

AgentScanner 是一个智能体安全网关，用于监控和管理智能体的安全访问。它提供了智能体管理、策略管理、日志管理等核心功能，帮助用户确保智能体的安全运行。

## 2. 技术栈

### 2.1 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Java | 17 | 开发语言 |
| Spring Boot | 3.1.0 | 后端框架 |
| Spring Cloud | 2023.0.0 | 微服务框架 |
| MyBatis Plus | 3.5.5 | ORM框架 |
| MySQL | 8.0.33 | 数据库 |
| Redis | 3.2.6 | 缓存 |
| RabbitMQ | 3.12.11 | 消息队列 |
| JJWT | 0.12.3 | JWT认证 |
| Springdoc OpenAPI | 2.3.0 | API文档 |
| Lombok | 1.18.26 | 代码简化 |

### 2.2 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.4.0 | 前端框架 |
| Vue Router | 4.2.5 | 路由管理 |
| Pinia | 2.1.7 | 状态管理 |
| Element Plus | 2.4.4 | UI组件库 |
| Axios | 1.6.2 | HTTP客户端 |
| Vite | 7.2.4 | 构建工具 |

### 2.3 基础设施

| 技术 | 版本 | 用途 |
|------|------|------|
| Nginx | 1.20+ | 反向代理 |
| Docker | 20.10+ | 容器化部署 |
| Git | 2.30+ | 版本控制 |

## 3. 系统架构

### 3.1 整体架构

AgentScanner 采用前后端分离的架构设计，主要包含以下几个部分：

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   前端应用      │     │   Nginx代理     │     │   后端服务      │
│  (Vue + Element │────▶│  (反向代理/静态 │────▶│ (Spring Boot)  │
│    Plus)        │     │   资源服务)     │     │                 │
└─────────────────┘     └─────────────────┘     └───────────┬─────┘
                                                             │
                                                             ▼
                                               ┌─────────────────┐
                                               │   数据库        │
                                               │  (MySQL)        │
                                               └─────────────────┘
```

### 3.2 后端架构

后端采用分层架构设计，主要包含以下几层：

1. **Controller层**：处理HTTP请求，调用Service层提供的服务
2. **Service层**：实现业务逻辑，调用Mapper层访问数据库
3. **Mapper层**：数据访问层，与数据库交互
4. **Entity层**：数据库实体类
5. **DTO层**：数据传输对象，用于前后端数据交互
6. **VO层**：视图对象，用于返回给前端的数据格式
7. **Config层**：配置类
8. **Exception层**：异常处理
9. **Utils层**：工具类

### 3.3 前端架构

前端采用Vue 3的组件化架构，主要包含以下几个部分：

1. **视图层**：位于`views`目录，包含各个页面组件
2. **组件层**：位于`components`目录，包含公共组件
3. **路由层**：位于`router`目录，配置路由信息
4. **状态管理层**：位于`store`目录，使用Pinia管理全局状态
5. **API层**：位于`api`目录，封装HTTP请求
6. **工具层**：位于`utils`目录，包含工具函数
7. **样式层**：位于`styles`目录，包含全局样式

## 4. 核心模块功能

### 4.1 智能体管理

- **智能体注册**：支持智能体的注册和管理
- **智能体状态监控**：实时监控智能体的运行状态
- **智能体配置管理**：管理智能体的配置信息

### 4.2 策略管理

- **策略定义**：支持自定义安全策略
- **策略分发**：将策略分发给各个智能体
- **策略执行监控**：监控策略的执行情况

### 4.3 日志管理

- **访问日志**：记录智能体的访问日志
- **操作日志**：记录用户的操作日志
- **安全日志**：记录安全事件日志
- **日志查询与分析**：支持日志的查询、过滤和分析

### 4.4 Nginx管理

- **Nginx配置生成**：根据策略自动生成Nginx配置
- **Nginx命令执行**：执行Nginx的启动、重启、重载等命令
- **Lua脚本管理**：管理Nginx使用的Lua脚本

## 5. 数据库设计

### 5.1 核心实体

1. **Agent（智能体）**
   - id：主键
   - name：智能体名称
   - description：描述
   - status：状态
   - created_at：创建时间
   - updated_at：更新时间

2. **Policy（策略）**
   - id：主键
   - name：策略名称
   - description：描述
   - content：策略内容
   - status：状态
   - created_at：创建时间
   - updated_at：更新时间

3. **Log（日志）**
   - id：主键
   - type：日志类型
   - content：日志内容
   - agent_id：关联的智能体ID
   - policy_id：关联的策略ID
   - created_at：创建时间

4. **User（用户）**
   - id：主键
   - username：用户名
   - password：密码（加密存储）
   - role：角色
   - status：状态
   - created_at：创建时间
   - updated_at：更新时间

## 6. API设计

### 6.1 智能体管理API

| URL | 方法 | 功能 |
|-----|------|------|
| /api/agents | GET | 获取智能体列表 |
| /api/agents/{id} | GET | 获取智能体详情 |
| /api/agents | POST | 创建智能体 |
| /api/agents/{id} | PUT | 更新智能体 |
| /api/agents/{id} | DELETE | 删除智能体 |

### 6.2 策略管理API

| URL | 方法 | 功能 |
|-----|------|------|
| /api/policies | GET | 获取策略列表 |
| /api/policies/{id} | GET | 获取策略详情 |
| /api/policies | POST | 创建策略 |
| /api/policies/{id} | PUT | 更新策略 |
| /api/policies/{id} | DELETE | 删除策略 |

### 6.3 日志管理API

| URL | 方法 | 功能 |
|-----|------|------|
| /api/logs | GET | 获取日志列表 |
| /api/logs/{id} | GET | 获取日志详情 |
| /api/logs | POST | 创建日志 |
| /api/logs/export | GET | 导出日志 |

### 6.4 用户管理API

| URL | 方法 | 功能 |
|-----|------|------|
| /api/users | GET | 获取用户列表 |
| /api/users/{id} | GET | 获取用户详情 |
| /api/users | POST | 创建用户 |
| /api/users/{id} | PUT | 更新用户 |
| /api/users/{id} | DELETE | 删除用户 |

## 7. 安全性考虑

### 7.1 认证与授权

- 使用JWT进行身份认证
- 基于角色的访问控制（RBAC）
- 密码加密存储

### 7.2 数据安全

- 数据库连接加密
- 敏感数据加密存储
- 数据传输使用HTTPS

### 7.3 防护措施

- 防止SQL注入
- 防止XSS攻击
- 防止CSRF攻击
- 防止暴力破解
- 限流和熔断机制

## 8. 部署架构

### 8.1 开发环境

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   前端开发服务器  │     │   后端开发服务器  │     │   开发数据库    │
│  (npm run dev)  │────▶│  (mvn spring-    │────▶│  (MySQL)        │
│                 │     │   boot:run)      │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 8.2 生产环境

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   Nginx代理     │     │   后端应用集群   │     │   生产数据库    │
│  (负载均衡)     │────▶│  (Spring Boot)  │────▶│  (MySQL主从)    │
│                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
          ▲                       ▲                       ▲
          │                       │                       │
          ▼                       ▼                       ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   前端静态资源   │     │   Redis缓存     │     │   RabbitMQ      │
│  (dist目录)      │     │                 │     │   消息队列      │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

## 9. 监控与维护

### 9.1 监控指标

- 系统运行状态
- API响应时间
- 错误率
- 数据库连接数
- 服务器资源使用率

### 9.2 日志管理

- 集中式日志存储
- 日志分级管理
- 日志查询与分析
- 日志告警机制

## 10. 未来规划

1. 支持更多智能体类型
2. 增强策略引擎功能
3. 提供更丰富的报表和分析功能
4. 支持多租户架构
5. 增强安全性功能
6. 提供API网关功能
7. 支持容器化部署（Docker/K8s）
